title: Tour
extends@: modular

form:
  fields:
    tabs:
      type: tabs
      active: 1
      fields:
        tour:
          type: tab
          title: Tour
          ordering@: content
          fields:

            header.id:
              type: hidden
              default: 'tmp  id'
              validate:
                required: true

            datasets_fieldset:
              type: fieldset
              title: Tour Datasets
              collapsible: true
              collapsed: true
              fields:
                
                header.datasets:
                  type: list
                  size: long
                  style: vertical
                  collapsed: false
                  collapsible: true
                  btnLabel: Add Dataset
                  controls: both
                  fields:

                    .id:
                      type: select
                      label: Select Dataset (required)
                      data-options@: ['Grav\Plugin\LeafletTourPlugin::getDatasetsList', false]
                      validate:
                        required: true

                    .include_all:
                      type: toggle
                      label: Include All Features
                      description: If disabled, only features added to the features list (further down) will be included.
                      highlight: 1
                      default: 1
                      options:
                        1: PLUGIN_ADMIN.ENABLED
                        0: PLUGIN_ADMIN.DISABLED
                      validate:
                        type: bool

                    .add_all:
                      type: toggle
                      label: Add All Features
                      description: On save, all (non-hidden) features from the dataset will automatically be added to the features list, if they are not already in the list.
                      highlight: 1
                      default: 0
                      options:
                        0: PLUGIN_ADMIN.DISABLED
                        1: PLUGIN_ADMIN.ENABLED
                      validate:
                        type: bool

            header.dataset_overrides_fieldset:
              type: fieldset
              title: Dataset Overrides
              collapsible: true
              collapsed: false
              data-fields@: 'Grav\Plugin\LeafletTourPlugin::getTourDatasetFields'

            options_fieldset:
              type: fieldset
              title: General Options
              collapsible: true
              collapsed: false
              fields:

                # legend_section:
                #   type: section
                #   title: Legend Options
                #   underline: true

                # header.include_legend:
                #   type: toggle
                #   label: Include Legend
                #   description: Adds a legend to the map, as long as at least one legend description is set.
                #   highlight: 1
                #   default: 1
                #   options:
                #     1: PLUGIN_ADMIN.ENABLED
                #     0: PLUGIN_ADMIN.DISABLED
                #   validate:
                #     type: bool

                # header.legend_toggles:
                #   type: toggle
                #   label: Allow Toggling Datasets in Legend
                #   description: Adds a checkbox for each dataset in the legend, which can be used to show/hide features for that dataset on the map. Requires including a legend.
                #   highlight: 1
                #   default: 0
                #   options:
                #     0: PLUGIN_ADMIN.DISABLED
                #     1: PLUGIN_ADMIN.ENABLED
                #   validate:
                #     type: bool

                # header.legend_basemaps:
                #   type: toggle
                #   label: Include Basemaps in Legend
                #   description: Adds a basemaps section to the legend, listing any basemaps used by the tour. Does not include the tile server. Basemaps will not be toggleable, even if datasets are. Requires include a legend.
                #   highlight: 1
                #   default: 0
                #   options:
                #     0: PLUGIN_ADMIN.DISABLED
                #     1: PLUGIN_ADMIN.ENABLED
                #   validate:
                #     type: bool

                # plugin_overrides_section:
                #   type: section
                #   title: Plugin Options Overrides
                #   text: These options override the default options set from the plugin configuration.
                #   underline: true

                # header.wide_column:
                #   type: toggle
                #   label: Wide Narrative Column
                #   description: If toggled, will change the narrative width from 33% to 40% of the page width.
                #   toggleable: true
                #   highlight: 1
                #   default: 0
                #   options:
                #     0: PLUGIN_ADMIN.DISABLED
                #     1: PLUGIN_ADMIN.ENABLED
                #   validate:
                #     type: bool

                # header.map_on_right:
                #   type: toggle
                #   label: Map Located on the Right
                #   description: If toggled, map will be on the right side of the page, with narrative column on the left. Disable this setting to switch their positions.
                #   toggleable: true
                #   highlight: 1
                #   default: 1
                #   options:
                #     1: PLUGIN_ADMIN.ENABLED
                #     0: PLUGIN_ADMIN.DISABLED
                #   validate:
                #     type: bool

                # header.show_map_location_in_url:
                #   type: toggle
                #   label: Show Map Location in URL
                #   description: If toggled, the current zoom level and center coordinates of the map location will be included in the page URL at the top of a given user's browser.
                #   toggleable: true
                #   highlight: 1
                #   default: 0
                #   options:
                #     0: PLUGIN_ADMIN.DISABLED
                #     1: PLUGIN_ADMIN.ENABLED
                #   validate:
                #     type: bool

                # header.attribution:
                #   type: editor
                #   label: Tour Attribution
                #   description: Provide some text to include in the tour footer.
                #   validate:
                #     type: textarea

                # tile_server_section: TODO: array
                #   type: section
                #   title: Tile Server and Basemaps
                #   text: Choose one of the tile servers from the dropdown menu, or input the URL and attribution for a tile server of your choice. You can also select additional basemaps to add. The tile server options will override the defaults from the plugin configuration.
                #   underline: true

                # header.tile_server_select:
                #   type: select
                #   label: Select a Tile Server
                #   toggleable: true
                #   default: 'stamenWatercolor'
                #   data-opotions@: 'Grav\Plugin\LeafletTourPlugin:getTileServerList'

                # header.tile_server_url:
                #   type: text
                #   label: Custom Tile Server URL
                #   description: Make sure to select "custom" for the tile server (here or in the plugin configuration) to use this field.

                # header.tile_server_attribution:
                #   type: text
                #   label: Custom Tile Server Attribution
                #   description: Add some HTML to include in the tour footer for the custom tile server provided above.

                # header.basemaps:
                #   type: select
                #   label: Additional Basemap Images
                #   description: Select any number of basemaps previously uploaded to the plugin configuration and added to the plugin basemaps information list.
                #   data-options@: 'Grav\Plugin\LeafletTourPlugin::getBasemapList'
                #   multiple: true
                #   validate:
                #     type: array

            advanced_fieldset:
              type: fieldset
              title: Advanced Options
              collapsible: true
              collapsed: true
              fields:
              
                # view_defaults_section:
                #   type: section
                #   title: View Defaults
                #   text: The following set default options for the view. They can be overridden from the view configuration.
                #   underline: true

                # header.remove_tile_server:
                #   type: toggle
                #   label: Remove Tile Server
                #   description: Removes the tile server from the map entirely when a custom basemap is currently in use. This will save loading time, but may look odd if the custom basemap does not cover sufficient area. This sets behavior for the tour itself when not in any view, as well as the default view behavior.
                #   highlight: 1
                #   default: 1
                #   options:
                #     1: PLUGIN_ADMIN.ENABLED
                #     0: PLUGIN_ADMIN.DISABLED
                #   validate:
                #     type: bool

                # header.only_show_view_features:
                #   type: toggle
                #   label: Only Show Current View Features
                #   description: When in a specific view, only the features included in that particular view will be displayed on the map.
                #   highlight: 1
                #   default: 0
                #   options:
                #     0: PLUGIN_ADMIN.DISABLED
                #     1: PLUGIN_ADMIN.ENABLED
                #   validate:
                #     type: bool

                # header.list_popup_buttons:
                #   type: toggle
                #   label: List Feature Popup Buttons
                #   description: Buttons for all feature popups will be added at the end of each view. Any buttons already included in that view's content (using shortcodes) will be excluded from the list to avoid repetition.
                #   highlight: 1
                #   default: 1
                #   options:
                #     1: PLUGIN_ADMIN.ENABLED
                #     0: PLUGIN_ADMIN.DISABLED
                #   validate:
                #     type: bool

                # start_section:
                #   type: section
                #   title: Starting Tour Position
                #   text: By default, the starting bounds for the tour will be determined by all included features. You can override this by providing bounds manually in the page header (expert mode) or by choosing a center and a distance (in degrees) from that center. You can choose a Point feature from any dataset included in the tour as the center, or you can set the latitude and longitude manually.
                #   underline: true

                # header.start.location:
                #   type: select
                #   label: Center Location
                #   data-options@: ['Grav\Plugin\LeafletTourPlugin::getFeatureList', true, true]

                # # TODO: columns?
                # header.start.lng:
                #   type: number
                #   label: Center Longitude
                #   description: Use degrees with a maximum of seven decimal places.
                #   validate:
                #     min: -180
                #     max: 180
                #     step: .0000001

                # header.start.lat:
                #   type: number
                #   label: Center Latitude
                #   description: Use degrees with a maximum of seven decimal places.
                #   validate:
                #     min: -90
                #     max: 90
                #     step: .0000001

                # header.start.distance:
                #   type: number
                #   label: Distance from Center
                #   description: Use degrees with a maximum of seven decimal places.
                #   size: long
                #   validate:
                #     min: 0
                #     step: .0000001

                # header.start.bounds.north:
                #   type: hidden
                # header.start.bounds.south:
                #   type: hidden
                # header.start.bounds.east:
                #   type: hidden
                # header.start.bounds.west:
                #   type: hidden

                # max_bounds_section:
                #   type: section
                #   title: Maximum Map Bounds
                #   text: These will define how far the map can be panned. All four values must be provided or map bounds will be ignored. If the tour or view bounds exceed the max bounds, the max bounds will be ignored or modified. Provide all values in degrees with a maximum of seven decimal places.
                #   underline: true
                  
                # max_bounds_columns:
                #   type: columns
                #   fields:
                #     col1:
                #       type: column
                #       fields:

                #         header.max_bounds.north:
                #           type: number
                #           label: North
                #           description: Latitude for the Northern (top) boundary of the map.
                #           validate:
                #             min: -90
                #             max: 90
                #             step: .0000001

                #         header.max_bounds.south:
                #           type: number
                #           label: South
                #           description: Latitude for the Southern (bottom) boundary of the map.
                #           validate:
                #             min: -90
                #             max: 90
                #             step: .0000001

                #     col2:
                #       type: column
                #       fields:

                #         header.max_bounds.east:
                #           type: number
                #           label: East
                #           description: Longitude for the Eastern (right) boundary of the map.
                #           validate:
                #             min: -180
                #             max: 180
                #             step: .0000001

                #         header.max_bounds.west:
                #           type: number
                #           label: West
                #           description: Longitude for the Western (left) boundary of the map.
                #           validate:
                #             min: -180
                #             max: 180
                #             step: .0000001

                # zoom_section:
                #   type: section
                #   title: Zoom
                #   text: Define the maximum and minimum zoom levels (from 0 to 28) for the map.
                #   underline: true

                # zoom_columns:
                #   type: columns
                #   fields:
                #     col1:
                #       type: column
                #       fields:

                #         header.zoom_max:
                #           type: number
                #           label: Maximum Zoom
                #           description: The map will not zoom in closer than this level. Defaults to 16.
                #           default: 16
                #           validate:
                #             min: 0
                #             max: 28
                #             step: 1

                #     col2:
                #       type: column
                #       fields:

                #         header.zoom_min:
                #           type: number
                #           label: Minimum Zoom
                #           description: The map will not zoom out farther than this level. Defaults to 8.
                #           default: 8
                #           validate:
                #             min: 0
                #             max: 28
                #             step: 1

            features_fieldset:
              type: fieldset
              title: Features
              icon: map-marker
              collapsible: true
              collapsed: true
              fields:

                header.features:
                  type: list
                  label: Included Features
                  description: A list (in order) of all features included in the tour. This is not necessary for features of a given dataset if the "include all" option has been selected, but it still provides a method for determining feature order, including hidden features, and/or overriding feature popup content. When possible, it is better to edit feature popup content directly from the dataset page.
                  style: vertical
                  collapsed: true
                  btnLabel: Add Feature
                  controls: both
                  placement: position
                  fields:

                    .id:
                      type: select
                      label: Feature (required)
                      data-options@: 'Grav\Plugin\LeafletTourPlugin::getTourFeatures'
                      validate:
                        required: true

                    .remove_popup:
                      type: toggle
                      label: Remove Popup
                      description: If popup content has been added for this feature from the dataset, that content will not be displayed. It will also remove any automatically created popup content from properties selected in the dataset. If you want to modify the popup content but keep the automatically created content, use the override option below.
                      highlight: 1
                      default: 0
                      options:
                        1: PLUGIN_ADMIN.ENABLED
                        0: PLUGIN_ADMIN.DISABLED
                      validate:
                        type: bool

                    .popup_content:
                      type: editor
                      label: Popup Content
                      description: Overrides the feature popup content from the dataset configuration. Does not affect properties that have been selected to automatically add. Note that current content may not show up until you click inside the text area.
                      validate:
                        type: textarea
